<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portfolio Stacked Scroll 5 Items</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    section {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .portfolio-wrapper {
      position: relative;
    }

    .portfolio-inner {
      position: sticky;
      top: 0;
      overflow: hidden;
    }

    .case-study {
      position: absolute;
      top: 0; /* always start from top */
      left: 50%;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      transition: transform 0.6s ease, width 0.6s ease;
      will-change: transform, width;
    }

    .case1 { background: #009345; z-index: 1; }
    .case2 { background: #00c9a7; z-index: 2; }
    .case3 { background: #0077ff; z-index: 3; }
    .case4 { background: #ff8800; z-index: 4; }
    .case5 { background: #ff0055; z-index: 5; }
  </style>
</head>

<body>
  <section style="background:#eee;">Section 1</section>

  <div class="portfolio-wrapper" id="portfolio">
    <div class="portfolio-inner" id="portfolioInner">
      <div class="case-study case1">Case Study 1</div>
      <div class="case-study case2">Case Study 2</div>
      <div class="case-study case3">Case Study 3</div>
      <div class="case-study case4">Case Study 4</div>
      <div class="case-study case5">Case Study 5</div>
    </div>
  </div>

  <section style="background:#ccc;">Section 3</section>

  <script>
    const portfolio = document.getElementById('portfolio');
    const portfolioInner = document.getElementById('portfolioInner');
    const slides = document.querySelectorAll('.case-study');
    const steps = slides.length;
    const gap = 40; // vertical gap between slides

    // shrink rules after each new slide completes
    const widthMap = [0, 120, 90, 60, 30, 0];

    function setHeights() {
      const vh = window.innerHeight;
      const totalHeight = vh + gap * (steps - 1);
      portfolioInner.style.height = `${totalHeight}px`;
      portfolio.style.height = `${vh * steps}px`; // enough scroll space
    }

    function onScroll() {
      const vh = window.innerHeight;
      const scrollY = window.scrollY || window.pageYOffset;
      const progress = Math.min(Math.max((scrollY - portfolio.offsetTop) / vh, 0), steps);

      slides.forEach((slide, i) => {
        slide.style.zIndex = i + 1;
        const prevSlide = slides[i - 1];
        const targetY = i * gap; // 0, 40px, 80px, 120px, etc.

        if (i === 0) {
          // first item always pinned at top
          slide.style.transform = `translateX(-50%) translateY(0)`;
          slide.style.width = (progress >= 2) ? `calc(100% - ${widthMap[1]}px)` : '100%';
        } else {
          if (progress > i) {
            // fully revealed
            slide.style.transform = `translateX(-50%) translateY(${targetY}px)`;
            slide.style.width = '100%';
            if (prevSlide) prevSlide.style.width = `calc(100% - ${widthMap[i]}px)`;
          } else if (progress > i - 1) {
            // during animation
            const t = progress - (i - 1);
            const startY = vh;
            const y = startY * (1 - t) + targetY * t;
            slide.style.transform = `translateX(-50%) translateY(${y}px)`;
            slide.style.width = '100%';
            if (prevSlide) prevSlide.style.width = `calc(100% - ${widthMap[i] * t}px)`;
          } else {
            // not reached yet
            slide.style.transform = `translateX(-50%) translateY(${vh}px)`;
            slide.style.width = '100%';
          }
        }
      });
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', () => {
      setHeights();
      onScroll();
    });

    setHeights();
    onScroll();
  </script>
</body>

</html>
